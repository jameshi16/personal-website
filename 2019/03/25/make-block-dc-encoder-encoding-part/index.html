







<!doctype html>
<html class="height-full">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Good morning! :coffee:.In the course I’ve enrolled in for the vacation, I had to work with the MakeBlock 25mm DC Encoder Motor, which looks something like this:It’s a really nice DC motor. It spins. It stops. It starts. Good torque. Pretty okay motor, except for its price; although I can’t compla..." />
    <title>CodingIndex's Random Shenanigans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Blog posts (last 10, atom feed)">
    <link href="/feed/anime.xml" type="application/atom+xml" rel="alternate" title="Weaboo Corner (last 10, atom feed)">
    <link href="/assets/styles.css" rel="stylesheet" type="text/css">
    <link href="/favicon.png" rel="icon" type="image/png" sizes="128x128">
  </head>
  <body class="height-full" style="width: 100vw; overflow-x: hidden">




  <div class="container-xl pt-6 p-responsive text-center">
    

<img src="/CodingIndex.png" class="mb-3" style="max-width: 150px;" alt="CodingIndex Logo">
<p class="mb-3 f4 text-gray">A (human) index that likes to code<br><span class="f5">Also drinks way too much coffee <img class="emoji" title=":coffee:" alt=":coffee:" src="https://github.githubassets.com/images/icons/emoji/unicode/2615.png" height="20" width="20"></span></p>
<nav class="UnderlineNavi container-md"> 
  <div class="UnderlineNav-body" style="display: block">
    <a href="/" role="tab" title="Home" class="UnderlineNav-item selected">Home</a>
    <a href="/anime" role="tab" title="Anime" class="UnderlineNav-item ">Anime</a>
    <a href="/about" role="tab" title="About" class="UnderlineNav-item ">About</a>
  </div>
</nav>



    <div class="container-xl f4 text-left border rounded-2 bg-white p-3 p-sm-5 mt-6">
      <p class="f5"><a href="/" class="d-flex flex-items-center"><svg height="16" class="octicon octicon-chevron-left mr-2 v-align-middle" fill="#0366d6" aria-label="Home" viewbox="0 0 16 16" version="1.1" width="16" role="img"><path d="M9.78 12.78a.75.75 0 0 1-1.06 0L4.47 8.53a.75.75 0 0 1 0-1.06l4.25-4.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042L6.06 8l3.72 3.72a.75.75 0 0 1 0 1.06Z"></path></svg>Home</a></p>
      <h1 class="f00-light lh-condensed">MakeBlock DC Encoder Motors - The Encoding Part</h1>
      <p class="text-gray mb-5">Published Mar 25, 2019 09:30</p>
      
  <div class="article">
    <p>Good morning! <img class="emoji" title=":coffee:" alt=":coffee:" src="https://github.githubassets.com/images/icons/emoji/unicode/2615.png" height="20" width="20">.</p>

<p>In the course I’ve enrolled in for the vacation, I had to work with the <a href="http://www.robotpark.com/DC-Encoder-Motor-Pack-25mm-Makeblock-En" target="_blank" rel="noopener noreferrer">MakeBlock 25mm DC Encoder Motor</a>, which looks something like this:</p>

<p><img src="/images/20190325_1.jpg" width="200px" alt="The 25mm DC Encoder Motor"></p>

<p>It’s a really nice <strong>DC</strong> motor. It spins. It stops. It starts. Good torque. Pretty okay motor, except for its price; although I can’t complain because I got it for free.</p>

<p><strong>However</strong>: I’ll complain about one thing; the lack of documentation. I had to perform a few rounds of trial and error just to make sense of the value I’m reading from the “encoding” part of the motor. For context, this motor has a few pins: M+, M-, GND, VCC, A, and B. After a round of searching, I found <a href="http://learn.makeblock.com/ultimate2-arduino-programming/" target="_blank" rel="noopener noreferrer">this link</a>, which displayed the following code:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"MeMegaPi.h"</span><span class="cp">
</span><span class="k">const</span> <span class="n">byte</span> <span class="n">interruptPin</span> <span class="o">=</span><span class="mi">18</span><span class="p">;</span>    
<span class="k">const</span> <span class="n">byte</span> <span class="n">NE1</span><span class="o">=</span><span class="mi">31</span><span class="p">;</span>                 
<span class="kt">long</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">time</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_time</span><span class="p">;</span>
<span class="n">MeMegaPiDCMotor</span> <span class="nf">motor1</span><span class="p">(</span><span class="n">PORT1B</span><span class="p">);</span>   
<span class="kt">uint8_t</span> <span class="n">motorSpeed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">interruptPin</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">NE1</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
    <span class="n">attachInterrupt</span><span class="p">(</span><span class="n">digitalPinToInterrupt</span><span class="p">(</span><span class="n">interruptPin</span><span class="p">),</span> <span class="n">blink</span><span class="p">,</span><span class="n">RISING</span><span class="p">);</span>   
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>   
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">motor1</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>       <span class="c1">// value: between -255 and 255</span>
    <span class="n">time</span> <span class="o">=</span><span class="n">millis</span><span class="p">();</span> 
    <span class="k">if</span><span class="p">(</span><span class="n">time</span><span class="o">-</span><span class="n">last_time</span><span class="o">&gt;</span><span class="mi">2000</span><span class="p">)</span>    
    <span class="p">{</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">count</span><span class="p">);</span>
          <span class="n">last_time</span><span class="o">=</span><span class="n">time</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">blink</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">NE1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>   
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="k">else</span>
    <span class="n">count</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr>

<h1 id="what-the-code-does">What the code does</h1>
<p>It reads an analog value via interrupt from pin A (the interrupt pin) and pin B (the NE1 pin). This produces the following output after 10 revolutions:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0
-1436
-3177
-4917
-5741
</code></pre></div></div>

<p>And so, my first question was: “なに これ”? (what’s this) 
Here is what I know:</p>

<ol>
  <li>This is some kind of encoder, and I’ve generalized it to be either a rotary encoder, or a hall effect encoder (both are revolution counting encoders)</li>
  <li>The values make no sense</li>
</ol>

<hr>

<h1 id="what-i-did">What I did</h1>
<p>I went online to search for solutions, to no avail. This product has a niche market, because it was designed for use with a MakeBlock microcontroller, like the <a href="http://learn.makeblock.com/en/megapi/" target="_blank" rel="noopener noreferrer">MegaPi</a>, hence, it was difficult to find any kind of answers to this question I had.</p>

<p>After a while, I decided to do a little bit of a trial and error. By recognizing some patterns in subsequent outputs, I realized the following:</p>

<ol>
  <li>The weird numbers are related to the Gear Ratio of the motor.</li>
  <li>The weird numbers are related to another constant.</li>
</ol>

<p>With that, I performed a few calculations, to find that the number was between 7.5 to 8.5. Testing with 7 and 8, I figured out that 8 was the correct answer. In other words, the formula for calculating the <strong>number of revolutions</strong> from the <strong>werid number thing</strong> produced by the encoder motor is: <code class="language-plaintext highlighter-rouge">(weird number thing / gear ratio) / 8</code>. After discussing with my friend a little, I realized that the ‘8’ can represent the number of ticks within the motor; in his words: “(there) could be the 8 points about that revolution”. Afterwards, I found this <a href="https://forum.makeblock.com/t/information-about-25mm-dc-encoder-motor/10791/3" target="_blank" rel="noopener noreferrer">fourm post</a>, which had the Original Poster (OP) sharing the same frustration (lack of documentation) as me, but more importantly, contained the information that the “ticks per rev is 8”. Alongside the Gear Ratio, this makes the formula the correct method of calculating the revolutions per minute.</p>

<p>Here’s the working Arduino sketch:</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"MeMegaPi.h"</span><span class="cp">
#define GearRatio 75
</span><span class="k">const</span> <span class="n">byte</span> <span class="n">interruptPin</span> <span class="o">=</span><span class="mi">18</span><span class="p">;</span>    
<span class="k">const</span> <span class="n">byte</span> <span class="n">NE1</span><span class="o">=</span><span class="mi">31</span><span class="p">;</span>                 
<span class="kt">long</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">time</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_time</span><span class="p">;</span>
<span class="n">MeMegaPiDCMotor</span> <span class="nf">motor1</span><span class="p">(</span><span class="n">PORT1B</span><span class="p">);</span>   
<span class="kt">uint8_t</span> <span class="n">motorSpeed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">interruptPin</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">NE1</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
    <span class="n">attachInterrupt</span><span class="p">(</span><span class="n">digitalPinToInterrupt</span><span class="p">(</span><span class="n">interruptPin</span><span class="p">),</span> <span class="n">blink</span><span class="p">,</span><span class="n">RISING</span><span class="p">);</span>   
    <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>   
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">motor1</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">motorSpeed</span><span class="p">);</span>       <span class="c1">// value: between -255 and 255</span>
    <span class="n">time</span> <span class="o">=</span><span class="n">millis</span><span class="p">();</span> 
    <span class="k">if</span><span class="p">(</span><span class="n">time</span><span class="o">-</span><span class="n">last_time</span><span class="o">&gt;</span><span class="mi">2000</span><span class="p">)</span>    
    <span class="p">{</span>
          <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">((</span><span class="n">count</span> <span class="o">/</span> <span class="n">GearRatio</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">);</span>
          <span class="n">last_time</span><span class="o">=</span><span class="n">time</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">blink</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">NE1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>   
    <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="k">else</span>
    <span class="n">count</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<hr>

<p>Well, that was a frustrating experience. Remember, if you’re developing something for anyone else (especially developers) to use, please make sure you document everything, and make that documentation searchable or something; it’s really difficult to use a product without the proper documentation.</p>

<p>Until next time.</p>

<p>Happy coding,</p>

<p>CodingIndex</p>

  </div>

    </div>
  </div>

    <footer>
      <div class="container-md p-3 text-gray text-center">
        <p>Copyright © CodingIndex 2023</p>
      </div>
    </footer>
  </body>
</html>

