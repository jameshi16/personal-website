







<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Dinosaur Architecture&amp;lt;&amp;lt; Take me back to Part 1Solution Dinosaur was designed to combine Solution Uno and Solution Duo; although this means inheriting both the good and bad of the two solutions, a device will have more options to stay connected to both the VPN provider and the ZeroTi..." />
    <title>CodingIndex's Random Shenanigans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Blog posts (last 10, atom feed)">
    <link href="/feed/anime.xml" type="application/atom+xml" rel="alternate" title="Weaboo Corner (last 10, atom feed)">
    <link href="/assets/styles.css" rel="stylesheet" type="text/css">
    <link href="/favicon.png" rel="icon" type="image/png" sizes="128x128">
  </head>
  <body class="christmas" style="width: 100vw; overflow: hidden">
    <div class="snowfall">
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
        <div class="snow"></div>
      
    </div>
    <div style="height: 100vh; overflow-y: scroll">




  <div class="container-xl pt-6 p-responsive text-center">
    

<img src="/CodingIndex.png" class="mb-3" style="max-width: 150px;" alt="CodingIndex Logo">
<p class="mb-3 f4 text-gray">A (human) index that likes to code<br><span class="f5">Also drinks way too much coffee <img class="emoji" title=":coffee:" alt=":coffee:" src="https://github.githubassets.com/images/icons/emoji/unicode/2615.png" height="20" width="20"></span></p>
<nav class="UnderlineNavi container-md"> 
  <div class="UnderlineNav-body" style="display: block">
    <a href="/" role="tab" title="Home" class="UnderlineNav-item selected">Home</a>
    <a href="/anime" role="tab" title="Anime" class="UnderlineNav-item ">Anime</a>
    <a href="/about" role="tab" title="About" class="UnderlineNav-item ">About</a>
  </div>
</nav>



    <div class="container-xl f4 text-left border rounded-2 bg-white p-3 p-sm-5 mt-6">
      <p class="f5"><a href="/" class="d-flex flex-items-center"><svg height="16" class="octicon octicon-chevron-left mr-2 v-align-middle" fill="#0366d6" aria-label="Home" viewbox="0 0 16 16" version="1.1" width="16" role="img"><path fill-rule="evenodd" d="M9.78 12.78a.75.75 0 01-1.06 0L4.47 8.53a.75.75 0 010-1.06l4.25-4.25a.75.75 0 011.06 1.06L6.06 8l3.72 3.72a.75.75 0 010 1.06z"></path></svg>Home</a></p>
      <h1 class="f00-light lh-condensed">ZeroTier OpenVPN NAT - Part 4</h1>
      <p class="text-gray mb-5">Published Feb 14, 2021 13:27</p>
      
  <div class="article">
    <p><img src="/images/20210214_5.png" style="max-width: 400px; width: 100%; margin: 0 auto; display: block;" alt="Architecture"></p>
<p class="text-center text-gray lh-condensed-ultra f6">Dinosaur Architecture</p>

<p><a href="/2021/02/14/zerotier-openvpn-nat-part-1#bookmark">&lt;&lt; Take me back to Part 1</a></p>

<p>Solution Dinosaur was designed to combine <a href="/2021/02/14/zerotier-openvpn-nat-part-2">Solution Uno</a> and <a href="/2021/02/14/zerotier-openvpn-nat-part-3">Solution Duo</a>; although this means inheriting both the good and bad of the two solutions, a device will have more options to stay connected to both the VPN provider and the ZeroTier network from anywhere in the world.</p>

<h1 id="step-0-pre-requisites">Step 0: Pre-requisites</h1>

<p>You should complete the all the steps for <a href="/2021/02/14/zerotier-openvpn-nat-part-2">Solution Uno</a>, and up to Step 3 of <a href="/2021/02/14/zerotier-openvpn-nat-part-3">Solution Duo</a>. Do note that a Single Board Computer device is required, alongside the obvious need for an Oracle Cloud account.</p>

<h1 id="step-1-create--configure-openvpn-server">Step 1: Create &amp; Configure OpenVPN server</h1>

<p>This step is quite similar to <a href="/2021/02/14/zerotier-openvpn-nat-part-3#step4">Step 4 of Solution Duo</a>; hence, I’ll be borrowing some text from that step.</p>

<p>Before we can even configure the OpenVPN server, we must become a Certificate Authority and issue certificates for both the server and client. This allows clients authenticate the server, and vice-versa.</p>

<p>Find a suitable working folder, and create a folder to store CA related files:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make-cadir openvpn-ca
</code></pre></div></div>

<p>Then, append the following lines into the <code class="language-plaintext highlighter-rouge">openvpn-ca/vars</code> file:</p>
<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">export</span> <span class="py">KEY_COUNTRY</span><span class="p">=</span><span class="s">"US"</span>
<span class="err">export</span> <span class="py">KEY_EMAIL</span><span class="p">=</span><span class="s">"donotemail@exdee.exdee"</span>
<span class="err">export</span> <span class="py">KEY_CITY</span><span class="p">=</span><span class="s">"Somewhere"</span>
<span class="err">export</span> <span class="py">KEY_PROVINCE</span><span class="p">=</span><span class="s">"There"</span>
<span class="err">export</span> <span class="py">KEY_ORG</span><span class="p">=</span><span class="s">"CodingIndex"</span>
<span class="err">export</span> <span class="py">KEY_OU</span><span class="p">=</span><span class="s">"ADMIN"</span>
<span class="err">export</span> <span class="py">KEY_NAME</span><span class="p">=</span><span class="s">"server"</span>
</code></pre></div></div>

<p>Change the values of all the variables to whatever you want; just try not to change <code class="language-plaintext highlighter-rouge">KEY_NAME</code>, unless you have to - it is easier to follow the guide if you name your key “server”.</p>

<p>Next, you will want to change your working directory to <code class="language-plaintext highlighter-rouge">openvpn-ca</code>, so that you can run the <code class="language-plaintext highlighter-rouge">easyrsa</code> executable with the following subcommands:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>openvpn-ca
./easyrsa init-pki
./easyrsa build-ca
./easyrsa build-server-full server nopass
./easyrsa gen-dh
<span class="nb">mkdir </span>keys <span class="o">&amp;&amp;</span> openvpn <span class="nt">--genkey</span> <span class="nt">--secret</span> keys/ta.key
</code></pre></div></div>

<p>Easy-rsa may prompt you for additional information.</p>
<blockquote>
  <p>Run <code class="language-plaintext highlighter-rouge">easyrsa --pki-dir=&lt;insert directory here&gt;</code> to change where the PKIs are stored, which by default is <code class="language-plaintext highlighter-rouge">${PWD}/pki</code>.</p>
</blockquote>

<p>You <em>should</em> then create as many client certificates as the devices you plan to connect to this server. But it is not strictly necessary, as one certificate can be used for multiple devices. Here is how to create a single client certificate:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./easyrsa build-client-full client1 nopass
</code></pre></div></div>

<p>Copy the appropriate certificates to the <code class="language-plaintext highlighter-rouge">/etc/openvpn</code> folder:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp </span>keys/ta.key <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/pki/private/server.key <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/pki/issued/server.crt <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/pki/dh.pem /etc/openvpn
</code></pre></div></div>

<p>Next, download the sample server configuration file from the OpenVPN’s Git repository (if you are on an Ubuntu minimal image, you should not have this on your system because it has been minimized):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /etc/openvpn
<span class="nb">sudo </span>wget https://raw.githubusercontent.com/OpenVPN/openvpn/master/sample/sample-config-files/server.conf
</code></pre></div></div>

<p>Edit the server configuration file; for this part, we will configure a TCP OpenVPN server listening on port 443, but the method to configure are the same for the UDP OpenVPN server listening on port 1194 if you decide to host two OpenVPN servers. Modify the following lines by searching for them in your favourite editor:</p>

<p><code class="language-plaintext highlighter-rouge">/etc/openvpn/server.conf</code>:</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">port</span> <span class="m">443</span>
<span class="n">proto</span> <span class="n">tcp</span>
<span class="n">user</span> <span class="n">nobody</span>
<span class="n">group</span> <span class="n">nogroup</span>
<span class="n">cipher</span> <span class="n">AES</span>-<span class="m">256</span>-<span class="n">CBC</span>
<span class="n">auth</span> <span class="n">SHA256</span>
<span class="n">push</span> <span class="s2">"redirect-gateway def1 bypass-dhcp"</span>
<span class="n">push</span> <span class="s2">"dhcp-option DNS 208.67.222.222"</span>
<span class="n">push</span> <span class="s2">"dhcp-option DNS 208.67.220.220"</span>
<span class="n">dh</span> <span class="n">dh</span>.<span class="n">pem</span>

<span class="c"># these line does not exist by default
</span><span class="n">auth</span> <span class="n">SHA256</span>
<span class="n">up</span> /<span class="n">etc</span>/<span class="n">openvpn</span>/<span class="n">up</span>-<span class="n">script</span>.<span class="n">sh</span>
<span class="n">down</span> /<span class="n">etc</span>/<span class="n">openvpn</span>/<span class="n">down</span>-<span class="n">script</span>.<span class="n">sh</span>
</code></pre></div></div>

<p>Create the files <code class="language-plaintext highlighter-rouge">/etc/openvpn/up-script.sh</code> and <code class="language-plaintext highlighter-rouge">/etc/openvpn/down-script.sh</code>.</p>

<p><code class="language-plaintext highlighter-rouge">/etc/openvpn/up-script.sh</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">ZT_DEVICE</span><span class="o">=</span><span class="s2">"ztly52mmwy"</span>
<span class="nv">ZT_GATEWAY</span><span class="o">=</span><span class="s2">"172.25.0.1"</span>

<span class="nb">touch</span> /etc/iproute2/rt_tables.d/ovpn2zt.conf
<span class="nb">echo</span> <span class="s2">"42069 ovpn2zt"</span> <span class="o">&gt;</span> /etc/iproute2/rt_tables.d/ovpn2zt.conf

ip rule add from 10.8.0.0/24 table ovpn2zt
ip route add default via <span class="k">${</span><span class="nv">ZT_GATEWAY</span><span class="k">}</span> dev <span class="k">${</span><span class="nv">ZT_DEVICE</span><span class="k">}</span> table ovpn2zt
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">/etc/openvpn/down-script.sh</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="nv">ZT_DEVICE</span><span class="o">=</span><span class="s2">"ztly52mmwy"</span>
<span class="nv">ZT_GATEWAY</span><span class="o">=</span><span class="s2">"172.25.0.1"</span>

ip rule delete from 10.8.0.0/24 table ovpn2zt
ip route delete default via <span class="k">${</span><span class="nv">ZT_GATEWAY</span><span class="k">}</span> dev <span class="k">${</span><span class="nv">ZT_DEVICE</span><span class="k">}</span> table ovpn2zt

<span class="nb">rm</span> <span class="nt">-f</span> /etc/iproute2/rt_tables.d/ovpn2zt.conf
</code></pre></div></div>

<p>The CIDR, <code class="language-plaintext highlighter-rouge">10.8.0.0/24</code> is defined in <code class="language-plaintext highlighter-rouge">/etc/openvpn/server.conf</code>; as long as it has not been changed, the above scripts should work. Change the ZeroTier device variable to the one you noted earlier; the gateway variable should be the IP address of the host from Solution Uno. Remember to run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chmod</span> +x /etc/openvpn/up-script.sh /etc/openvpn/down-script.sh
</code></pre></div></div>

<p>Try starting the OpenVPN server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start openvpn@server
<span class="nb">sudo </span>systemctl status openvpn@server
</code></pre></div></div>

<p>If the server starts successfully, enable the service:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl <span class="nb">enable </span>openvpn@server
</code></pre></div></div>

<p>Now that all the services are in place, allow them through the UFW:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ufw allow 9993/udp <span class="c"># for ZeroTier</span>
ufw allow 443/tcp
ufw allow 1194/udp
</code></pre></div></div>

<p>In theory anyway. On Oracle Cloud VM instances, UFW rules are placed <strong>below</strong> a REJECT rule on the IPTables, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Chain INPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    4  1344 ACCEPT     all  --  tun0   any     anywhere             anywhere            
 848K  472M ACCEPT     all  --  any    any     anywhere             anywhere             state RELATED,ESTABLISHED
    0     0 ACCEPT     icmp --  any    any     anywhere             anywhere            
  688 59382 ACCEPT     all  --  lo     any     anywhere             anywhere            
    0     0 ACCEPT     udp  --  any    any     anywhere             anywhere             udp spt:ntp
 1294 75128 ACCEPT     tcp  --  any    any     anywhere             anywhere             state NEW tcp dpt:ssh
10739 5199K REJECT     all  --  any    any     anywhere             anywhere             reject-with icmp-host-prohibited
    0     0 ufw-before-logging-input  all  --  any    any     anywhere             anywhere            
    0     0 ufw-before-input  all  --  any    any     anywhere             anywhere            
    0     0 ufw-after-input  all  --  any    any     anywhere             anywhere            
    0     0 ufw-after-logging-input  all  --  any    any     anywhere             anywhere            
    0     0 ufw-reject-input  all  --  any    any     anywhere             anywhere            
    0     0 ufw-track-input  all  --  any    any     anywhere             anywhere 
</code></pre></div></div>

<p>In other words, UFW becomes absolutely useless. As an interesting side note, trying to connect to a port other than TCP port 22 will yield ‘Destination Host Unreachable’ error messages thanks to IPTable rejecting connections with <code class="language-plaintext highlighter-rouge">icmp-host-prohibited</code>. There are two ways to circumvent this:</p>
<ol>
  <li>Delete the REJECT rule;</li>
  <li>Add my own IPTable rules.</li>
</ol>

<p>For this guide, I decided to just <em>add</em> my own iptable rules, since I don’t know the implications of deleting the REJECT rule:</p>

<p><code class="language-plaintext highlighter-rouge">/etc/iptables/rules.v4</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>filter
:INPUT ACCEPT <span class="o">[</span>0:0]
...
<span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> INPUT <span class="nt">-p</span> udp <span class="nt">--dport</span> 1194 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> FORWARD <span class="nt">-s</span> tun0 <span class="nt">-j</span> ACCEPT
<span class="nt">-A</span> FORWARD <span class="nt">-s</span> zt+ <span class="nt">-j</span> ACCEPT
...
<span class="k">*</span>nat
...
<span class="nt">-A</span> POSTROUTING <span class="nt">-s</span> 10.8.0.0/24 <span class="nt">-o</span> zt+ <span class="nt">-j</span> MASQUERADE
...
</code></pre></div></div>

<p>Replace <code class="language-plaintext highlighter-rouge">zt+</code> with the actual ZeroTier device if you like to be less permissive.</p>

<h1 id="step-2-create-client-configurations">Step 2: Create Client Configurations</h1>

<p>This step is the same as <a href="/2021/02/14/zerotier-openvpn-nat-part-3#step5">Step 5 of Solution Duo</a>.</p>

<p>Now, we generate the <code class="language-plaintext highlighter-rouge">.ovpn</code> files used by the clients. For convenience (and to rip off <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04" target="_blank" rel="noopener noreferrer">DigitalOcean’s guide</a>), we’ll combine the CA certificate, Client certificate and Client’s key into the <code class="language-plaintext highlighter-rouge">.ovpn</code> file.</p>

<p>Firstly, we generate a working directory to store the files needed for the <code class="language-plaintext highlighter-rouge">.ovpn</code> file:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/client/files
</code></pre></div></div>

<p>Then, we download the example client configuration from the official Git repository:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-O</span> <span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/client/files/base.conf https://raw.githubusercontent.com/OpenVPN/openvpn/master/sample/sample-config-files/client.conf
</code></pre></div></div>

<p>Modify <code class="language-plaintext highlighter-rouge">client.conf</code> to match the server configuration (assuming TCP on 443):</p>

<p><code class="language-plaintext highlighter-rouge">${PWD}/client/client.conf</code>:</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">remote</span> <span class="n">x</span>.<span class="n">x</span>.<span class="n">x</span>.<span class="n">x</span> <span class="m">443</span>
<span class="n">proto</span> <span class="n">tcp</span>
<span class="n">user</span> <span class="n">nobody</span>
<span class="n">group</span> <span class="n">nogroup</span>
<span class="n">cipher</span> <span class="n">AES</span>-<span class="m">256</span>-<span class="n">CBC</span>
<span class="n">auth</span> <span class="n">SHA256</span>

<span class="c"># comment out these lines
</span>;<span class="n">ca</span> <span class="n">ca</span>.<span class="n">crt</span>
;<span class="n">cert</span> <span class="n">client</span>.<span class="n">crt</span>
;<span class="n">key</span> <span class="n">client</span>.<span class="n">key</span>
</code></pre></div></div>

<p>Replace <code class="language-plaintext highlighter-rouge">x.x.x.x</code> with the IP assigned to your Oracle VM instance.</p>

<p>The <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-openvpn-server-on-ubuntu-16-04" target="_blank" rel="noopener noreferrer">DigitalOcean guide</a> uses a script to generate the <code class="language-plaintext highlighter-rouge">.ovpn</code> file, so that is what we will be doing too. It essentially concatenates all the necessary files together and spits out an <code class="language-plaintext highlighter-rouge">.ovpn</code> file.</p>

<p><code class="language-plaintext highlighter-rouge">${PWD}/client/make_config.sh</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c"># First argument: Client identifier</span>
<span class="nv">PKI_DIR</span><span class="o">=</span>../pki
<span class="nv">CA_DIR</span><span class="o">=</span>../openvpn-ca
<span class="nv">OUTPUT_DIR</span><span class="o">=</span>./files
<span class="nv">BASE_CONFIG</span><span class="o">=</span>./files/base.conf

<span class="nb">cat</span> <span class="k">${</span><span class="nv">BASE_CONFIG</span><span class="k">}</span> <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;ca&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">PKI_DIR</span><span class="k">}</span>/ca.crt <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/ca&gt;\n&lt;cert&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">PKI_DIR</span><span class="k">}</span>/issued/<span class="k">${</span><span class="nv">1</span><span class="k">}</span>.crt <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/cert&gt;\n&lt;key&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">PKI_DIR</span><span class="k">}</span>/private/<span class="k">${</span><span class="nv">1</span><span class="k">}</span>.key <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/key&gt;\n&lt;tls-auth&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="k">${</span><span class="nv">CA_DIR</span><span class="k">}</span>/keys/ta.key <span class="se">\</span>
    &lt;<span class="o">(</span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s1">'&lt;/tls-auth&gt;'</span><span class="o">)</span> <span class="se">\</span>
    <span class="o">&gt;</span> <span class="k">${</span><span class="nv">OUTPUT_DIR</span><span class="k">}</span>/<span class="k">${</span><span class="nv">1</span><span class="k">}</span>.ovpn
</code></pre></div></div>

<p>Adjust the directories to their absolute paths just to be sure. Once you are confident that the paths are accurate, give the script the executable go-ahead, and run the script with the parameter of the client name (should be <code class="language-plaintext highlighter-rouge">client1</code>, as generated with <code class="language-plaintext highlighter-rouge">./easyrsa build-client-full client nopass</code>):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> &lt;path to client directory&gt;
<span class="nb">chmod</span> +x make_config.sh
./make_config.sh client1
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">.ovpn</code> should be generated in the <code class="language-plaintext highlighter-rouge">./files</code> directory. This file can then be transferred to another device, like your Android device or ISP-controlled router. Give it a spin, and ensure everything is in working order by:</p>
<ul>
  <li>Checking IP address with <a href="https://ifconfig.so" target="_blank" rel="noopener noreferrer">ifconfig.so</a>, or VPN provider internet checker;</li>
  <li>Checking ZeroTier connectivity by pinging peers in the same network.</li>
</ul>

<h1 id="conclusion">Conclusion</h1>

<p>Theoretically, you have set up Solution Dinosaur, which is the same set up I use personally - I may have missed out a few steps, so do your best to fill in the gaps!</p>

<p>Happy Coding</p>

<p>CodingIndex</p>

  </div>

    </div>
  </div>

      <footer>
        <div class="container-md p-3 text-gray text-center">
          <p>Copyright © CodingIndex 2021</p>
          <p>Merry Christmas, and Happy New Year! <img class="emoji" title=":christmas_tree:" alt=":christmas_tree:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f384.png" height="20" width="20"></p>
          <p>Santa Hat by <a href="https://www.flaticon.com/free-icon/hat_744546?term=santa%20hat&amp;page=1&amp;position=4&amp;related_item_id=744546" target="_blank" rel="noopener noreferrer">Vectors Market</a></p>
        </div>
      </footer>
    </div>
  </body>
</html>

